<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<title>clCreateFromDX9MediaSurfaceKHR</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
</head>
<body id="clCreateFromDX9MediaSurfaceKHR" class="article">
<div id="header">
<h1>clCreateFromDX9MediaSurfaceKHR</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Creates an OpenCL image object from a media surface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">cl_mem clCreateFromDX9MediaSurfaceKHR(cl_context context,
                                      cl_mem_flags flags,
                                      cl_dx9_media_adapter_type_khr adapter_type,
                                      void *surface_info,
                                      cl_uint plane,
                                      cl_int *errcode_ret)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="parameters">Parameters</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>context</code></dt>
<dd>
<p>A valid OpenCL context created from a media adapter.</p>
</dd>
<dt class="hdlist1"><code>flags</code></dt>
<dd>
<p>A bit-field that is used to specify usage information.
Refer to the table of allowed values for <code>flags</code> for <a href="clCreateBuffer.html"><code>clCreateBuffer</code></a>.
Only <code>CL_MEM_READ_ONLY</code>, <code>CL_MEM_WRITE_ONLY</code>, and <code>CL_MEM_READ_WRITE</code> values specified in the table of allowed values for <code>flags</code> for <a href="clCreateBuffer.html"><code>clCreateBuffer</code></a> can be used.</p>
</dd>
<dt class="hdlist1"><code>adapter_type</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>A value from enumeration of supported adapters described in the table of <code>cl_dx9_media_adapter_type_khr</code> values for <a href="clGetDeviceIDsFromDX9MediaAdapterKHR.html"><code>clGetDeviceIDsFromDX9MediaAdapterKHR</code></a>.
The type of <code>surface_info</code> is determined by the adapter type.
The implementation does not need to support all adapter types.
This approach provides flexibility to support additional adapter types in the future.
Supported adapter types are <code>CL_ADAPTER_D3D9_KHR</code>, <code>CL_ADAPTER_D3D9EX_KHR</code>, and <code>CL_ADAPTER_DXVA_KHR</code>.</p>
</div>
<div class="paragraph">
<p>If <code>adapter_type</code> is <code>CL_ADAPTER_D3D9_KHR</code>, <code>CL_ADAPTER_D3D9EX_KHR</code>, or <code>CL_ADAPTER_DXVA_KHR</code>, the <code>surface_info</code> points to the following structure:</p>
</div>
<div class="paragraph">
<p><code>typedef struct _cl_dx9_surface_info_khr { IDirect3DSurface9 *resource; HANDLE shared_handle; } cl_dx9_surface_info_khr;</code></p>
</div>
<div class="paragraph">
<p>For D3D9 surfaces, we need both the handle to the resource and the resource itself to have a sufficient amount of information to eliminate a copy of the surface for sharing in cases where this is possible.
Elimination of the copy is driver dependent.
<code>shared_handle</code> may be NULL and this may result in sub-optimal performance.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>surface_info</code></dt>
<dd>
<p>A pointer to one of the structures defined in the <code>adapter_type</code> description above passed in as a <code>void</code> *.</p>
</dd>
<dt class="hdlist1"><code>plane</code></dt>
<dd>
<p>The plane of resource to share for planar surface formats.
For planar formats, we use the plane parameter to obtain a handle to thie specific plane (Y, U or V for example).
For nonplanar formats used by media, <code>plane</code> must be 0.</p>
</dd>
<dt class="hdlist1"><code>errcode_ret</code></dt>
<dd>
<p>An appropriate error code.
If <code>errcode_ret</code> is NULL, no error code is returned.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="notes">Notes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The width and height of the returned OpenCL 2D image object are determined by the width and height of the plane of resource.
The channel type and order of the returned image object is determined by the format and plane of resource and are described in tables 9.10.3 and 9.10.4.</p>
</div>
<div class="paragraph">
<p>This call will increment the internal media surface count on <code>resource</code>.
The internal media surface reference count on <code>resource</code> will be decremented when the OpenCL reference count on the returned OpenCL memory object drops to zero.</p>
</div>
<div class="paragraph">
<p>General information about sharing memory objects with DX9 follows.</p>
</div>
<div class="paragraph">
<p>The goal of this extension is to allow applications to use media surfaces as OpenCL memory objects.
This allows efficient sharing of data between OpenCL and selected adapter APIs (only DX9 for now).
If this extension is supported, an OpenCL image object can be created from a media surface and the OpenCL API can be used to execute kernels that read and/or write memory objects that are media surfaces.
Note that OpenCL memory objects may be created from the adapter media surface if and only if the OpenCL context has been created from that adapter.</p>
</div>
<div class="paragraph">
<p>If this extension is supported by an implementation, the string "cl_khr_dx9_media_sharing" will be present in the <code>CL_PLATFORM_EXTENSIONS</code> (see <a href="clGetPlatformInfo.html"><code>clGetPlatformInfo</code></a>) or <code>CL_DEVICE_EXTENSIONS</code> (see <a href="clGetDeviceInfo.html"><code>clGetDeviceInfo</code></a>).</p>
</div>
<div class="paragraph">
<p>As currently proposed the interfaces for this extension would be provided in <code>cl_dx9_media_sharing.h</code>.</p>
</div>
<div class="paragraph">
<div class="title">Surface formats for Media Surface Sharing</div>
<p>This section includes the D3D surface formats that are supported when the adapter type is one of the Direct 3D lineage.
Using a D3D surface format not listed here is an error.
To extend the use of this extension to support media adapters beyond DirectX9 tables similar to the ones in this section will need to be defined for the surface formats supported by the new media adapter.
All implementations that support this extension are required to support the NV12 surface format, the other surface formats supported are the same surface formats that the adapter you are sharing with supports as long as they are listed in the tables below (Tables 9.10.3 and 9.10.4).</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">FOUR CC code</th>
<th class="tableblock halign-left valign-top">CL image format (channel order, channel data type)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>FOURCC('N', 'V', '1', '2'), Plane 0</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_R, CL_UNORM_INT8</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>FOURCC('N', 'V', '1', '2'), Plane 1</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_RG, CL_UNORM_INT8</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>FOURCC('Y', 'V', '1', '2'), Plane 0</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_R, CL_UNORM_INT8</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>FOURCC('Y', 'V', '1', '2'), Plane 1</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_R, CL_UNORM_INT8</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>FOURCC('Y', 'V', '1', '2'), Plane 2</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_R, CL_UNORM_INT8</code></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the table above, NV12 Plane 0 corresponds to the luminance (Y) channel and Plane 1 corresponds to the UV channels.
The YV12 Plane 0 corresponds to the Y channel, Plane 1 to the U channel and Plane 2 to the V channel.
Note that the YUV formats map to <code>CL_R</code> and <code>CL_RG</code> but do not perform any YUV to RGB conversion and vice-versa.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">D3D format</th>
<th class="tableblock halign-left valign-top">CL image format (channel order, channel data type)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>D3DFMT_R32F</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_R, CL_FLOAT</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>D3DFMT_R16F</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_R, CL_HALF_FLOAT</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>D3DFMT_L16</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_R, CL_UNORM_INT16</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>D3DFMT_A8</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_A, CL_UNORM_INT8</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>D3DFMT_L8</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_R, CL_UNORM_INT8</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>D3DFMT_G32R32F</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_RG, CL_FLOAT</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>D3DFMT_G16R16F</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_RG, CL_HALF_FLOAT</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>D3DFMT_G16R16</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_RG, CL_UNORM_INT16</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>D3DFMT_A8L8</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_RG, CL_UNORM_INT8</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>D3DFMT_A32B32G32R32F</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_RGBA, CL_FLOAT</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>D3DFMT_A16B16G16R16F</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_RGBA, CL_HALF_FLOAT</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>D3DFMT_A16B16G16R16</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_RGBA, CL_UNORM_INT16</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>D3DFMT_A8B8G8R8</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_RGBA, CL_UNORM_INT8</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>D3DFMT_X8B8G8R8</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_RGBA, CL_UNORM_INT8</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>D3DFMT_A8R8G8B8</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_BGRA, CL_UNORM_INT8</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>D3DFMT_X8R8G8B8</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>CL_BGRA, CL_UNORM_INT8</code></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that D3D9 format names seem to imply that the order of the color channels are switched relative to OpenCL but this is not the case.
For example, layout of channels for each pixel for <code>D3DFMT_A32FB32FG32FR32F</code> is the same as <code>CL_RGBA</code>, <code>CL_FLOAT</code>.</p>
</div>
<div class="paragraph">
<p>Properties of media surface objects may be queried using <a href="clGetMemObjectInfo.html"><code>clGetMemObjectInfo</code></a> and <a href="clGetImageInfo.html"><code>clGetImageInfo</code></a> with <code>param_name</code> <code>CL_MEM_DX9_MEDIA_ADAPTER_TYPE_KHR</code>, <code>CL_MEM_DX9_MEDIA_SURFACE_INFO_KHR</code> and <code>CL_IMAGE_DX9_MEDIA_SURFACE_PLANE_KHR</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="errors">Errors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Returns a valid non-zero 2D image object and <code>errcode_ret</code> is set to <code>CL_SUCCESS</code> if the 2D image object is created successfully.
Otherwise, it returns a NULL value with one of the following error values returned in <code>errcode_ret</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CL_INVALID_CONTEXT</code> if <code>context</code> is not a valid context.</p>
</li>
<li>
<p><code>CL_INVALID_VALUE</code> if values specified in <code>flags</code> are not valid or if <code>plane</code> is not a valid plane of <code>resource</code> specified in <code>surface_info</code>.</p>
</li>
<li>
<p><code>CL_INVALID_DX9_MEDIA_SURFACE_KHR</code> if <code>resource</code> specified in <code>surface_info</code> is not a valid resource or is not associated with <code>adapter_type</code> (e.g., <code>adapter_type</code> is set to <code>CL_ADAPTER_D3D9_KHR</code> and <code>resource</code> is not a Direct3D 9 surface created in <code>D3DPOOL_DEFAULT</code>).</p>
</li>
<li>
<p><code>CL_INVALID_DX9_MEDIA_SURFACE_KHR</code> if <code>shared_handle</code> specified in <code>surface_info</code> is not NULL or a valid handle value.</p>
</li>
<li>
<p><code>CL_INVALID_DX9_MEDIA_SURFACE_KHR</code> if <code>adapter_type</code> is set to a media adapter and the <code>surface_info</code> does not reference a media surface of the required type, or if <code>adapter_type</code> is set to a media adapter type and <code>surface_info</code> does not contain a valid reference to a media surface on that adapter, by <a href="clGetMemObjectInfo.html"><code>clGetMemObjectInfo</code></a> when <code>param_name</code> is a surface or handle when the image was not created from an appropriate media surface, and from <a href="clGetImageInfo.html"><code>clGetImageInfo</code></a> when <code>param_name</code> is <code>CL_IMAGE_DX9_MEDIA_PLANE_KHR</code> and image was not created from an appropriate media surface.</p>
</li>
<li>
<p><code>CL_INVALID_IMAGE_FORMAT_DESCRIPTOR</code> if the texture format of <code>resource</code> is not listed in tables 9.10.3 and 9.10.4.</p>
</li>
<li>
<p><code>CL_INVALID_OPERATION</code> if there are no devices in <code>context</code> that support <code>adapter_type</code>.</p>
</li>
<li>
<p><code>CL_OUT_OF_RESOURCES</code> if there is a failure to allocate resources required by the OpenCL implementation on the device.</p>
</li>
<li>
<p><code>CL_OUT_OF_HOST_MEMORY</code> if there is a failure to allocate resources required by the OpenCL implementation on the host.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="seealso">Also see</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="cl_khr_dx9_media_sharing.html"><code>cl_khr_dx9_media_sharing</code></a>, <a href="clCreateBuffer.html"><code>clCreateBuffer</code></a>,</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="specification">Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://www.khronos.org/registry/cl/specs/opencl-2.1-extensions.pdf#page=87" target="_blank">OpenCL 2.1 Extensions Specification, page 87</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="copyright">Copyright</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="copyright.html">Copyright &#169; 2007-2017 The Khronos Group Inc.</a></p>
</div>
</div>
</div>
</div>
</body>
</html>