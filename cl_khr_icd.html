<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<title>cl_khr_icd</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
</head>
<body id="cl_khr_icd" class="article">
<div id="header">
<h1>cl_khr_icd</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Extension through which the Khronos OpenCL installable client driver loader (ICD Loader) may expose multiple separate vendor installable client drivers (Vendor ICDs) for OpenCL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#pragma OPENCL EXTENSION cl_khr_icd : enable</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a platform extension which defines a simple mechanism through which the Khronos OpenCL installable client driver loader (ICD Loader) may expose multiple separate vendor installable client drivers (Vendor ICDs) for OpenCL.
An application written against the ICD Loader will be able to access all <code>cl_platform_ids</code> exposed by all vendor implementations with the ICD Loader acting as a demultiplexor.
If this extension is supported by an implementation, the string <code>cl_khr_icd</code> will be present in the <code>CL_PLATFORM_EXTENSIONS</code> string described in the table of allowed values for <code>param_name</code> for <a href="clGetDeviceInfo.html"><code>clGetDeviceInfo</code></a>.</p>
</div>
<div class="paragraph">
<p>If the <code>cl_khr_icd</code> extension is supported, then the <a href="clIcdGetPlatformIDsKHR.html"><code>clIcdGetPlatformIDsKHR</code></a> function is enabled.</p>
</div>
<div class="paragraph">
<p>The official source for the ICD loader is available at the Khronos website.
The complete <code>_cl_icd_dispatch</code> structure is defined in the header <code>icd_dispatch.h</code> which is available as a part of the source code.</p>
</div>
<div class="paragraph">
<div class="title">Inferring Vendors from Function Call Arguments</div>
<p>At every OpenCL function call, the ICD Loader infers the vendor ICD function to call from the arguments to the function.
An object is said to be ICD compatible if it is of the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>     struct _cl_&lt;object&gt;
     {
         struct _cl_icd_dispatch *dispatch;
         // ... remainder of internal data
     };</pre>
</div>
</div>
<div class="paragraph">
<p><code>&lt;object&gt;</code> is one of <code>platform_id</code>, <code>device_id</code>, <code>context</code>, <code>command_queue</code>, <code>mem</code>, <code>program</code>, <code>kernel</code>, <code>event</code>, or <code>sampler</code>.</p>
</div>
<div class="paragraph">
<p>The structure <code>_cl_icd_dispatch</code> is a function pointer dispatch table which is used to direct calls to a particular vendor implementation.
All objects created from ICD compatible objects must be ICD compatible.</p>
</div>
<div class="paragraph">
<p>A link to source code which defines the entries in the function table structure <code>_cl_icd_dispatch</code> is available in the Sample Code section of the OpenCL specification.
The order of the functions in <code>_cl_icd_dispatch</code> is determined by the ICD Loader&#8217;s source.
The ICD Loader&#8217;s source&#8217;s <code>_cl_icd_dispatch</code> table is to be appended to only.</p>
</div>
<div class="paragraph">
<p>Functions which do not have an argument from which the vendor implementation may be inferred are ignored, with the exception of <code>clGetExtensionFunctionAddress</code>.
which is described below.</p>
</div>
<div class="paragraph">
<div class="title">ICD Data</div>
<p>A Vendor ICD is defined by two pieces of data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Vendor ICD library specifies a library which contains the OpenCL entry points for the vendor&#8217;s OpenCL implementation.
The vendor ICD&#8217;s library file name should include the vendor name, or a vendor-specific implementation identifier.</p>
</li>
<li>
<p>The Vendor ICD extension suffix is a short string which specifies the default suffix for extensions implemented only by that vendor.
See Additions to Chapter 9 for details on the mechanism through which this is accomplished.
The vendor suffix string is optional.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">ICD Loader Vendor Enumeration on Windows</div>
<p>To enumerate Vendor ICDs on Windows, the ICD Loader scans the values in the registry key <code>HKEY_LOCAL_MACHINE\SOFTWARE\Khronos\OpenCL\Vendors</code>.
For each value in this key which has <code>DWORD</code> data set to 0, the ICD Loader opens the dynamic link library specified by the name of the value using <code>LoadLibraryA</code>.</p>
</div>
<div class="paragraph">
<p>For example, if the registry contains the following value</p>
</div>
<div class="listingblock">
<div class="content">
<pre>     [HKEY_LOCAL_MACHINE\SOFTWARE\Khronos\OpenCL\Vendors]
     "c:\\vendor a\\vndra_ocl.dll"=dword:00000000</pre>
</div>
</div>
<div class="paragraph">
<p>then the ICD will open the library &#8220;c:\vendor a\vndra_ocl.dll&#8221;.</p>
</div>
<div class="paragraph">
<div class="title">ICD Loader Vendor Enumeration on Linux</div>
<p>To enumerate vendor ICDs on Linux, the ICD Loader scans the files in the path <code>/etc/OpenCL/vendors</code>.
For each file in this path, the ICD Loader opens the file as a text file.
The expected format for the file is a single line of text which specifies the Vendor ICD&#8217;s library.
The ICD Loader will attempt to open that file as a shared object using <code>dlopen()</code>.
Note that the library specified may be an absolute path or just a file name.</p>
</div>
<div class="paragraph">
<p>For example, if the following file exists <code>/etc/OpenCL/vendors/VendorA.icd</code> and contains the text <code>libVendorAOpenCL.so</code> then the ICD Loader will load the library &#8220;libVendorAOpenCL.so&#8221;.</p>
</div>
<div class="paragraph">
<div class="title">ICD Loader Vendor Enumeration on Android</div>
<p>To enumerate vendor ICDs on Android, the ICD Loader scans the files in the path <code>/system/vendor/Khronos/OpenCL/vendors</code>.
For each file in this path, the ICD Loader opens the file as a text file.
The expected format for the file is a single line of text which specifies the Vendor ICD&#8217;s library.
The ICD Loader will attempt to open that file as a shared object using <code>dlopen()</code>.
Note that the library specified may be an absolute path or just a file name.</p>
</div>
<div class="paragraph">
<p>For example, if the following file exists <code>/system/vendor/Khronos/OpenCL/vendors/VendorA.icd</code> and contains the text <code>libVendorAOpenCL.so</code> then the ICD Loader will load the library &#8220;libVendorAOpenCL.so&#8221;.</p>
</div>
<div class="paragraph">
<div class="title">Adding a Vendor Library</div>
<p>Upon successfully loading a Vendor ICD&#8217;s library, the ICD Loader queries the following functions from the library: <a href="clIcdGetPlatformIDsKHR.html"><code>clIcdGetPlatformIDsKHR</code></a>, <a href="clGetPlatformInfo.html"><code>clGetPlatformInfo</code></a>, and <code>clGetExtensionFunctionAddress</code>.
If any of these functions are not present then the ICD Loader will close and ignore the library.</p>
</div>
<div class="paragraph">
<p>Next the ICD Loader queries available ICD-enabled platforms in the library using <a href="clIcdGetPlatformIDsKHR.html"><code>clIcdGetPlatformIDsKHR</code></a>.
For each of these platforms, the ICD Loader queries the platform&#8217;s extension string to verify that <code>cl_khr_icd</code> is supported, then queries the platform&#8217;s Vendor ICD extension suffix using <a href="clGetPlatformInfo.html"><code>clGetPlatformInfo</code></a> with the value <code>CL_PLATFORM_ICD_SUFFIX_KHR</code>.</p>
</div>
<div class="paragraph">
<p>If any of these steps fail, the ICD Loader will ignore the Vendor ICD and continue on to the next.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="seealso">Also see</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="EXTENSION.html">EXTENSION</a>, <a href="clIcdGetPlatformIDsKHR.html"><code>clIcdGetPlatformIDsKHR</code></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="specification">Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://www.khronos.org/registry/cl/specs/opencl-2.1-extensions.pdf#page=127" target="_blank">OpenCL 2.1 Extensions Specification, page 127</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="copyright">Copyright</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="copyright.html">Copyright &#169; 2007-2017 The Khronos Group Inc.</a></p>
</div>
</div>
</div>
</div>
</body>
</html>